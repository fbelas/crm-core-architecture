<%# Para lidar-mos com a quantidade de dados %>
<%# foi necessario construir o objecto para preencher as linhas da tabela %>
<%# que depois passa para o stimulus %>
<%
result = []
@professionals_search_results&.each do |elem|

    full_name_link = content_tag :div do
            link_to edit_professional_path(elem.customer_id),
                    class: "",
                    title: I18n.t("mouseover_messages.go_to_professional_file"),
                    target: "_blank" do
                "<i class='fa-solid fa-file-user'></i> #{elem.full_name}".html_safe
            end
        end

    affiliations_list = elem.affiliations.map { |affiliation| "<i class='fa-solid fa-house-chimney'></i> #{affiliation}" }.join("<br>")
=begin
    edit = content_tag :div do
        link_to professional_edit_through_search_form_path(elem.customer_id, id: elem.customer_id),
                class: "btn btn-dark_green inactive_button_border mb-3",
                style: "color: white;align-content: space-evenly;",
                data: { turbo_frame: "generic_responsive_modal" },
                title: "Edit Affiliação" do
            "<i class='fa-solid fa-pen'></i> editar".html_safe
        end
    end
=end
    status= I18n.t("label_institutions.#{elem.status}")

    result << [
            elem.customer_id,
            elem.external_id_1,
            status,
            full_name_link,
            elem.specialties,
            affiliations_list

   ]
end
%>

<%= turbo_stream.replace 'flash_notification', partial: "shared/flash_notification" %>
<%#= turbo_stream.replace 'professional_searched_table', partial: "prof_dept_affiliations/modals/institution_add_new_prof_dept_affiliation_table" %>
<%= turbo_stream.append 'professional_searched_table_container' do %>
    <script>
        (function(){
            let html_obj = document.getElementById("professional_searched_table_container");
            html_obj.dispatchEvent(new CustomEvent('ReloadNewData', {detail: <%= raw result.to_json %>}));
        })()
    </script>
<% end  %>
